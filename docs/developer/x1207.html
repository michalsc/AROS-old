<HTML
><HEAD
><TITLE
>Expanded Error Diagnostics</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.42"><LINK
REL="HOME"
TITLE="The Amiga Research OS"
HREF="book1.html"><LINK
REL="UP"
TITLE="Tasks, Processes and the Shell"
HREF="chap-tasks.html"><LINK
REL="PREVIOUS"
TITLE="Local and Global Variables"
HREF="x1204.html"><LINK
REL="NEXT"
TITLE="Parsing Arguments"
HREF="x1275.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
><SPAN
CLASS="PRODUCTNAME"
>The Amiga Research OS</SPAN
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1204.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Tasks, Processes and the Shell</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1275.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN1207"
>Expanded Error Diagnostics</A
></H1
><P
>Most functions of <A
HREF="dos-library.html"
><TT
CLASS="FILENAME"
>dos.library</TT
></A
>
        set the secondary error-code of the process structure on error. This
        way the caller can determine, why a certain system-call failed.
        Imagine, the function <TT
CLASS="FUNCTION"
>Open()</TT
>, which opens a
        named file, fails. There can be multiple reasons for this: maybe the
        file named doesn't exist, maybe it is read protected. To find this
        out, you can query the secondary error-code set by the last function by
        using
        <DIV
CLASS="FUNCSYNOPSIS"
><P
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="FUNCSYNOPSISINFO"
>#include &#60;proto/dos.h&#62;</PRE
></TD
></TR
></TABLE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>LONG <B
CLASS="FSFUNC"
>IoErr</B
></CODE
>(void);</CODE
></P
><P
></P
></DIV
></P
><P
>Dos-functions return one of the <SPAN
CLASS="SYMBOL"
>ERROR_</SPAN
>
        definitions from <A
HREF="dos-dos-h.html#DOS-DOS-ERROR"
><TT
CLASS="FILENAME"
>dos/dos.h</TT
></A
>.
        Applications can, of course, process these error-codes by hand (which
        is useful in many cases), but often we just want to inform the user
        what went wrong. (Applications normally need not care, if a file
        could not be opened, because it did not exist or because it was read
        protected.) To output human-readable error messages,
        <TT
CLASS="FILENAME"
>dos.library</TT
> provides two
        functions:
        <DIV
CLASS="FUNCSYNOPSIS"
><P
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="FUNCSYNOPSISINFO"
>#include &#60;proto/dos.h&#62;</PRE
></TD
></TR
></TABLE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>LONG <B
CLASS="FSFUNC"
>Fault</B
></CODE
>(LONG <VAR
CLASS="PDPARAM"
>code</VAR
>, STRPTR <VAR
CLASS="PDPARAM"
>header</VAR
>, STRPTR <VAR
CLASS="PDPARAM"
>buffer</VAR
>, LONG <VAR
CLASS="PDPARAM"
>length</VAR
>);</CODE
></P
><P
><CODE
><CODE
CLASS="FUNCDEF"
>BOOL <B
CLASS="FSFUNC"
>PrintFault</B
></CODE
>(LONG <VAR
CLASS="PDPARAM"
>code</VAR
>, STRPTR <VAR
CLASS="PDPARAM"
>header</VAR
>);</CODE
></P
><P
></P
></DIV
></P
><P
>While <TT
CLASS="FUNCTION"
>PrintFault()</TT
> simply prints an error
        message to the <A
HREF="g1724.html#GLOS-STDFH"
><I
CLASS="GLOSSTERM"
>standard output</I
></A
>,
        <TT
CLASS="FUNCTION"
>Fault()</TT
> fills a supplied buffer
        with the message. Both functions take a <TT
CLASS="PARAMETER"
><I
>code</I
></TT
>
        argument. This is the code to be converted into a string. You can also
        supply a <TT
CLASS="PARAMETER"
><I
>header</I
></TT
> string, which will prefix the
        error message. <TT
CLASS="PARAMETER"
><I
>header</I
></TT
> may be NULL, in which
        case nothing is prefixed.</P
><P
><TT
CLASS="FUNCTION"
>Fault()</TT
> also required a pointer to a
        <TT
CLASS="PARAMETER"
><I
>buffer</I
></TT
>, which is to be filled with the converted
        string. The <TT
CLASS="PARAMETER"
><I
>length</I
></TT
> of this buffer (in bytes)
        is to be passed in as last argument. The total number of characters
        put into the buffer is returned. You are on the safe side, if your
        buffer has a size for 83 character plus the size of the header.</P
><P
>Examples for the use of these functions can be found in later
        chapters, especially in the chapter about <A
HREF="chap-files.html"
>Files
        and Directories</A
>.</P
><P
>Secondary error-codes of a program are handed back to the
        caller. If this is a shell, the secondary error-code will be put
        into the field <TT
CLASS="STRUCTFIELD"
><I
>cli_Result2</I
></TT
> of the shell
        structure (struct <SPAN
CLASS="STRUCTNAME"
>CommandLineInterface</SPAN
> as
        defined in <A
HREF="dos-dosextens-h.html#DOS-DOSEXTENS-COMMANDLINEINTERFACE"
><TT
CLASS="FILENAME"
>dos/dosextens.h</TT
></A
>
        and <A
HREF="sect-shell.html"
>discussed later</A
>).</P
><P
>You can also set the secondary error-code yourself. This way,
        you can either to pass it back to another function in your program or
        to your caller. To set the secondary error, use
        <DIV
CLASS="FUNCSYNOPSIS"
><P
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="FUNCSYNOPSISINFO"
>#include &#60;proto/dos.h&#62;</PRE
></TD
></TR
></TABLE
><P
><CODE
><CODE
CLASS="FUNCDEF"
>LONG <B
CLASS="FSFUNC"
>SetIoErr</B
></CODE
>(LONG <VAR
CLASS="PDPARAM"
>code</VAR
>);</CODE
></P
><P
></P
></DIV
>
        <TT
CLASS="PARAMETER"
><I
>code</I
></TT
> is the new secondary error-code and
        the old secondary error-code is returned.</P
><P
><TT
CLASS="FUNCTION"
>SetIoErr()</TT
> will be used in the
        <A
HREF="chap-boopsi.html"
>chapter about object orientation</A
>.</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1204.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1275.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Local and Global Variables</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="chap-tasks.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Parsing Arguments</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>