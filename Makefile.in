# Main makefile for AROS
# Copyright (C) 1998 AROS - The Amiga Research OS
#
# $Id$
default: all

TOP := $(shell pwd)
include $(TOP)/config/make.cfg

all: makedirs mmake
	$(MMAKE) AROS.AROS

docs: mmake
	$(MMAKE) AROS.docs

all-docs: mmake
	$(MMAKE) AROS.all-docs

makedirs:
	@$(RM) $(TOP)/errors
	@$(FOR) dir in $(BINDIR) $(GENDIR) $(TOOLDIR) ; do \
	    $(IF) [ ! -d $$dir ]; then \
		$(ECHO) "mkdir $$dir" ; \
		$(MKDIR) "$$dir" ; \
	    else true ; fi ; \
	done
	@$(IF) [ ! -f $(BINDIR)/.gdbinit ]; then \
	    $(CP) _gdbinit $(BINDIR)/.gdbinit ; \
	else true ; fi

mmake : tools/MetaMake/Makefile $(MMAKE)

tools/MetaMake/configure : tools/MetaMake/configure.in
	cd tools/MetaMake ; autoconf

tools/MetaMake/Makefile.in : tools/MetaMake/Makefile.am
	cd tools/MetaMake ; automake

tools/MetaMake/Makefile : tools/MetaMake/configure \
		tools/MetaMake/Makefile.in
	cd tools/MetaMake ; ./configure --prefix=$(TOOLDIR)

$(MMAKE): tools/MetaMake/mmake.c $(GENMF)
	$(MAKE) -C tools/MetaMake
	cp tools/MetaMake/mmake $(MMAKE)

$(GENMF): tools/genmf/genmf.c
	$(MAKE) -C tools/genmf TOP=$(TOP)

install:
	$(MMAKE) AROS.install

clean:
	$(MMAKE) AROS.clean

.PHONY: default all makedirs docs clean install

